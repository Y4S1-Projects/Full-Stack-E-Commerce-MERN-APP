# X-Frame-Options (Anti-Clickjacking) Header Not Set - Vulnerability Fix Documentation

## Vulnerability Overview

### What is X-Frame-Options?
X-Frame-Options is an HTTP response header that indicates whether a browser should be allowed to render a page in a `<frame>`, `<iframe>`, `<embed>` or `<object>`. This header is used to avoid clickjacking attacks by ensuring that content is not embedded into other sites.

### Vulnerability Details
- **OWASP Category**: A05:2021 – Security Misconfiguration
- **CWE ID**: 1021
- **Risk Level**: Medium
- **Impact**: Without X-Frame-Options header, applications are vulnerable to clickjacking and UI redressing attacks

## Technical Implementation

### 1. Backend Implementation (Node.js/Express)

#### Using Helmet.js (Recommended)
```javascript
const express = require('express')
const helmet = require('helmet')

const app = express()

// X-Frame-Options configuration
app.use(helmet({
    frameguard: {
        action: 'deny'  // Options: 'deny', 'sameorigin', or { action: 'allow-from', domain: 'https://example.com' }
    }
}))
```

#### Manual Implementation
```javascript
const express = require('express')
const app = express()

// Manually set X-Frame-Options header
app.use((req, res, next) => {
    res.setHeader('X-Frame-Options', 'DENY')
    next()
})
```

### 2. Frontend Implementation

#### HTML Meta Tags (frontend/public/index.html)
```html
<head>
    <meta http-equiv="X-Frame-Options" content="DENY">
</head>
```

#### Production Server Configuration
```javascript
// In frontend-server.js
app.use(helmet({
    frameguard: {
        action: 'deny'
    }
}))
```

## X-Frame-Options Values

### DENY
- **Usage**: `X-Frame-Options: DENY`
- **Effect**: Page cannot be displayed in a frame, regardless of the site attempting to do so
- **Security Level**: Highest
- **Recommended**: For maximum security

### SAMEORIGIN
- **Usage**: `X-Frame-Options: SAMEORIGIN`
- **Effect**: Page can only be displayed in a frame on the same origin as the page itself
- **Security Level**: Medium
- **Use Case**: When you need to embed your own pages in frames

### ALLOW-FROM
- **Usage**: `X-Frame-Options: ALLOW-FROM https://example.com`
- **Effect**: Page can only be displayed in a frame on the specified origin
- **Security Level**: Medium
- **Note**: Deprecated in many browsers, use CSP frame-ancestors instead

## Implementation Examples

### Complete Backend Setup
```javascript
const express = require('express')
const cors = require('cors')
const helmet = require('helmet')

const app = express()

// Security Headers Configuration
app.use(helmet({
    contentSecurityPolicy: {
        directives: {
            defaultSrc: ["'self'"],
            styleSrc: ["'self'", "'unsafe-inline'"],
            scriptSrc: ["'self'"],
            imgSrc: ["'self'", "data:", "https:"],
            connectSrc: ["'self'"],
            frameSrc: ["'none'"],        // CSP equivalent
            frameAncestors: ["'none'"]   // CSP frame-ancestors
        }
    },
    frameguard: {
        action: 'deny'  // X-Frame-Options
    }
}))

app.use(cors({
    origin: process.env.FRONTEND_URL,
    credentials: true
}))

// Your routes here
```

### Nginx Configuration
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    # Anti-clickjacking header
    add_header X-Frame-Options "DENY" always;
    
    # Alternative: CSP frame-ancestors (more modern)
    add_header Content-Security-Policy "frame-ancestors 'none';" always;
    
    location / {
        root /var/www/html;
        try_files $uri $uri/ /index.html;
    }
}
```

### Apache Configuration
```apache
<IfModule mod_headers.c>
    Header always set X-Frame-Options "DENY"
    # Alternative: CSP frame-ancestors
    Header always set Content-Security-Policy "frame-ancestors 'none';"
</IfModule>
```

## Testing and Verification

### 1. Command Line Testing
```bash
# Test the header
curl -I http://localhost:8080/api/test

# Look for this header in response:
# X-Frame-Options: DENY
```

### 2. Browser Testing
```html
<!-- Test page to verify clickjacking protection -->
<!DOCTYPE html>
<html>
<head>
    <title>Clickjacking Test</title>
</head>
<body>
    <h1>Clickjacking Test</h1>
    <iframe src="http://localhost:8080" width="800" height="600"></iframe>
    <!-- This iframe should be blocked if X-Frame-Options is working -->
</body>
</html>
```

### 3. Expected Browser Behavior
When X-Frame-Options is properly configured:
- Browser console shows: `Refused to display 'http://localhost:8080' in a frame because it set 'X-Frame-Options' to 'deny'.`
- The iframe remains blank or shows an error

## Modern Alternative: CSP frame-ancestors

### Why CSP frame-ancestors?
- More flexible than X-Frame-Options
- Better browser support for complex scenarios
- Part of Content Security Policy standard

### Implementation
```javascript
// Using CSP frame-ancestors instead of X-Frame-Options
app.use(helmet({
    contentSecurityPolicy: {
        directives: {
            frameAncestors: ["'none'"]  // Equivalent to X-Frame-Options: DENY
            // frameAncestors: ["'self'"]  // Equivalent to X-Frame-Options: SAMEORIGIN
            // frameAncestors: ["https://trusted-site.com"]  // Allow specific origins
        }
    }
}))
```

## Security Considerations

### 1. Defense in Depth
Use both X-Frame-Options and CSP frame-ancestors:
```javascript
app.use(helmet({
    contentSecurityPolicy: {
        directives: {
            frameAncestors: ["'none'"]
        }
    },
    frameguard: {
        action: 'deny'
    }
}))
```

### 2. Application-Specific Considerations
- **Admin panels**: Always use DENY
- **Public content**: Consider SAMEORIGIN if embedding is needed
- **API endpoints**: DENY is recommended
- **Embedded widgets**: Use ALLOW-FROM or CSP with specific origins

### 3. Browser Compatibility
- X-Frame-Options: Supported by all modern browsers
- CSP frame-ancestors: Preferred for new applications
- Use both for maximum compatibility

## Common Issues and Solutions

### Issue 1: Legitimate Embedding Blocked
**Problem**: Your own application needs to embed pages in iframes
**Solution**: Use SAMEORIGIN instead of DENY
```javascript
frameguard: { action: 'sameorigin' }
```

### Issue 2: Third-party Integration Requirements
**Problem**: Trusted third-party needs to embed your content
**Solution**: Use CSP frame-ancestors with specific origins
```javascript
contentSecurityPolicy: {
    directives: {
        frameAncestors: ["'self'", "https://trusted-partner.com"]
    }
}
```

### Issue 3: Legacy Browser Support
**Problem**: Need to support very old browsers
**Solution**: Keep X-Frame-Options alongside CSP
```javascript
// Both headers for maximum compatibility
frameguard: { action: 'deny' },
contentSecurityPolicy: {
    directives: {
        frameAncestors: ["'none'"]
    }
}
```

## Attack Scenarios Prevented

### 1. Basic Clickjacking
```html
<!-- Malicious site attempting clickjacking -->
<iframe src="https://your-app.com/admin" style="opacity: 0; position: absolute; top: 0; left: 0;"></iframe>
<button>Click here for free money!</button>
```
**Result**: X-Frame-Options blocks the iframe, preventing the attack

### 2. UI Redressing
- Overlaying transparent elements over legitimate UI
- Tricking users into performing unintended actions
- Stealing clicks intended for legitimate buttons/links

### 3. Cross-Frame Scripting
- Malicious site embedding your app in iframe
- Attempting to access iframe content via JavaScript
- X-Frame-Options prevents the embedding entirely

## Verification Checklist

- [ ] X-Frame-Options header present in all HTTP responses
- [ ] Header value set to appropriate level (DENY recommended)
- [ ] No legitimate functionality broken by frame restrictions
- [ ] Test pages cannot embed your application in iframes
- [ ] Security scanners show vulnerability as resolved
- [ ] Both development and production environments configured

## Related Security Headers

### Combine with other security headers for comprehensive protection:
```javascript
app.use(helmet({
    frameguard: { action: 'deny' },                    // X-Frame-Options
    contentSecurityPolicy: {
        directives: {
            frameAncestors: ["'none'"],                 // CSP frame-ancestors
            defaultSrc: ["'self'"]                      // Overall CSP
        }
    },
    hsts: { maxAge: 31536000 },                        // HSTS
    noSniff: true,                                      // X-Content-Type-Options
    xssFilter: true                                     // X-XSS-Protection
}))
```

---

**Document Version**: 1.0  
**Last Updated**: September 20, 2025  
**Vulnerability Status**: FIXED ✅
